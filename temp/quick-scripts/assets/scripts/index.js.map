{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// import animation from \"../base/animate/animation\";\r\nimport Move from \"../src/base/move/Move\";\r\nimport baseScence from \"../src/base/load/baseScence\";\r\nimport eventBus from \"../src/base/EventBus/EventBus\";\r\n\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class index extends baseScence {\r\n    // 运动函数\r\n    \r\n    move: Move = new Move();\r\n\r\n    // 人物\r\n    @property(cc.Prefab)\r\n    people: cc.Prefab = null;\r\n\r\n    // 子弹\r\n    @property(cc.Prefab)\r\n    bullet: cc.Prefab = null;\r\n\r\n    // 对象池\r\n    bulletsPool: any = null;\r\n\r\n    @property(cc.Node)\r\n    bullets: cc.Node = null;\r\n\r\n    // x 位置\r\n    x: number = 0;\r\n\r\n    // y轴位置\r\n    y: number = 0;\r\n\r\n    // 人物宽度\r\n    peopleWidth: number = 0;\r\n\r\n    // 速度\r\n    speed: number = 200;\r\n\r\n    // 背景图\r\n    @property(cc.Node)\r\n    bg1: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    bg2: cc.Node = null;\r\n\r\n    bgSpeed: number = 10;\r\n\r\n    // 跳起按钮\r\n    @property(cc.Node)\r\n    btn: cc.Node = null;\r\n\r\n    // 碰撞体\r\n    @property(cc.Prefab)\r\n    collisionBody: cc.Prefab = null;\r\n\r\n    // 碰撞体对象池\r\n    collisionBodyNoodPool: any;\r\n\r\n    onLoad() {\r\n        this.createPeople();\r\n\r\n        this.createBullets();\r\n\r\n        this.putNoodPol()\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(dt: number) {\r\n        this.bgMove()\r\n    }\r\n\r\n    onDestroy() {\r\n        this._offPutNoodPol()\r\n    }\r\n    // 扔回对象池\r\n    public putNoodPol():void {\r\n        eventBus.$on(\"putNode\",this._putNoodPol.bind(this))\r\n        // cc.log(this)\r\n    }\r\n\r\n    private _putNoodPol(msg:cc.Node):void {\r\n\r\n        this.bulletsPool.put(msg);\r\n        // cc.log(this.bulletsPool,888)\r\n    }\r\n\r\n\r\n    private _offPutNoodPol():void {\r\n        eventBus.$off(\"putNode\",this._putNoodPol.bind(this))\r\n    }\r\n    // 创建人物\r\n    private createPeople() {\r\n\r\n        let people = cc.instantiate(this.people);\r\n\r\n        people.parent = cc.find(\"Canvas\");\r\n\r\n        this.x = people.x;\r\n\r\n        this.y = people.y;\r\n\r\n        this.peopleWidth = people.children[0].width;\r\n\r\n        let animation = people.children[0].getComponent(cc.Animation);\r\n\r\n        // cc.log(animation);\r\n\r\n        this.peolpleJump(people, people.x, people.y);\r\n\r\n        cc.log(cc.find(\"Canvas\").children, 666)\r\n\r\n        this.schedule(() => {\r\n\r\n            this.getBullet(people.x, people.y);\r\n\r\n            // this.impact();\r\n\r\n        }, 0.05)\r\n\r\n        this.schedule(()=>{\r\n\r\n            this.impact();\r\n\r\n        },0.3)\r\n    }\r\n\r\n\r\n\r\n    // 创建子弹\r\n    private createBullets() {\r\n\r\n        if(!this.bulletsPool) this.bulletsPool = new cc.NodePool(\"bullet\")\r\n        \r\n        for (var i = 0; i < 100; i++) {\r\n            let temp = cc.instantiate(this.bullet);\r\n            this.bulletsPool.put(temp)\r\n        }\r\n    }\r\n\r\n    // 每1秒取出一个子弹\r\n    private getBullet(peopleX: number, peopleY: number) {\r\n\r\n        let self = this;\r\n\r\n        let oneBullet;\r\n        for(var i = 0;i<5;i++) {\r\n            oneBullet = this.bulletsPool.get();\r\n        }\r\n        \r\n\r\n        oneBullet.x = peopleX - this.peopleWidth;\r\n\r\n        oneBullet.y = peopleY;\r\n\r\n        oneBullet.parent = this.bullets;\r\n\r\n        let y = oneBullet.y;\r\n\r\n        let x = oneBullet.x + this.peopleWidth;\r\n\r\n        this.move._moveTo(3, cc.winSize.width, y, oneBullet);\r\n\r\n\r\n\r\n        this.scheduleOnce(() => {\r\n            let remove = cc.removeSelf();\r\n            oneBullet.runAction(remove);\r\n            oneBullet.destroy();\r\n        }, 3)\r\n\r\n        if (this.bulletsPool.size() < 5) {\r\n\r\n            this.createBullets()\r\n\r\n        }\r\n\r\n    };\r\n\r\n    // 背景图移动\r\n    private bgMove() {\r\n        // cc.log(this.bg1.x)\r\n        this.bg1.x = this.bg1.x - this.bgSpeed;\r\n        this.bg2.x = this.bg2.x - this.bgSpeed;\r\n        if (this.bg1.x < -this.bg1.width) {\r\n            this.bg1.x = this.bg1.x + 2 * this.bg1.width;\r\n        }\r\n        if (this.bg2.x < -this.bg1.width) {\r\n            this.bg2.x = this.bg2.x + 2 * this.bg2.width;\r\n        }\r\n    }\r\n\r\n    // 监听角色跳起\r\n    private peolpleJump(node: cc.Node, x: number, y: number) {\r\n\r\n        this.btn.on(\"touchstart\", () => {\r\n\r\n            let animate = node.children[0].getComponent(cc.Animation);\r\n\r\n            animate.pause(\"people\")\r\n\r\n            animate.play(\"peopleJump\");\r\n\r\n            // 角色做位移\r\n            this.move._moveBy(0.3, x, y + 200, x, y - 200, node, true)\r\n\r\n            this.scheduleOnce(() => {\r\n                animate.play(\"people\")\r\n            }, 0.3)\r\n\r\n\r\n        }, this)\r\n    }\r\n\r\n    // 制作随机碰撞体\r\n    private impact() {\r\n\r\n        this.collisionBodyPool();\r\n\r\n        let moves = new Move();\r\n\r\n        let getCOllision;\r\n\r\n        if (this.collisionBodyNoodPool.size() > 0) {\r\n\r\n            getCOllision  = this.collisionBodyNoodPool.get();\r\n\r\n        }else {\r\n            this.collisionBodyPool();\r\n        }\r\n\r\n        // x 轴出现位置\r\n        getCOllision.x = cc.winSize.width;\r\n\r\n        // y 轴位置随机\r\n        let y = Math.random() * 150;\r\n\r\n        if (y > cc.winSize.height) {\r\n\r\n            y = Math.random() * 150;\r\n\r\n        }\r\n\r\n        // y轴出现位置\r\n        getCOllision.y = y;\r\n\r\n        getCOllision.parent = cc.find(\"Canvas/collisiton\");\r\n\r\n        moves._moveTo(4, -cc.winSize.width / 2 - 43, y, getCOllision);\r\n\r\n        this.scheduleOnce(() => {\r\n            let remove = cc.removeSelf();\r\n            getCOllision.runAction(remove)\r\n        }, 4)\r\n\r\n       \r\n        if (this.collisionBodyNoodPool.size() < 10) {\r\n\r\n            this.collisionBodyPool();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    // 碰撞体对象池\r\n    private collisionBodyPool() {\r\n\r\n        this.collisionBodyNoodPool = new cc.NodePool(\"collisionBody\")\r\n\r\n        for (var i = 0; i < 100; i++) {\r\n\r\n            let temp = cc.instantiate(this.collisionBody);\r\n\r\n            this.collisionBodyNoodPool.put(temp);\r\n\r\n        }\r\n    }\r\n}\r\n"]}